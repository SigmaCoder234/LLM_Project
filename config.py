#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
‚öôÔ∏è –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –¢–ï–õ–ï–ì–†–ê–ú –ë–û–¢–ê –ò –ê–ì–ï–ù–¢–û–í
"""

import logging
import os
from pathlib import Path

# ============================================================================
# TELEGRAM BOT
# ============================================================================

TELEGRAM_BOT_TOKEN = "8320009669:AAHiVLu-Em8EOXBNHYrJ0UhVX3mMMTm8Sg"
TELEGRAM_API_URL = "https://api.telegram.org"

# ============================================================================
# DATABASE - PostgreSQL
# ============================================================================

DB_USER = "tg_user"
DB_PASSWORD = "mnvm71"
DB_HOST = "176.108.248.211"
DB_PORT = 5432
DB_NAME = "teleguard"

POSTGRES_URL = f"postgresql+psycopg2://{DB_USER}:{DB_PASSWORD}@{DB_HOST}:{DB_PORT}/{DB_NAME}?sslmode=disable"

# ============================================================================
# REDIS
# ============================================================================

REDIS_HOST = "localhost"
REDIS_PORT = 6379
REDIS_DB = 0
REDIS_PASSWORD = None

def get_redis_config():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è Redis"""
    return {
        "host": REDIS_HOST,
        "port": REDIS_PORT,
        "db": REDIS_DB,
        "decode_responses": True,
        "password": REDIS_PASSWORD
    }

# ============================================================================
# REDIS –û–ß–ï–†–ï–î–ò (QUEUES)
# ============================================================================

QUEUE_AGENT_1_INPUT = "queue:agent1:input"
QUEUE_AGENT_1_OUTPUT = "queue:agent1:output"

QUEUE_AGENT_2_INPUT = "queue:agent2:input"
QUEUE_AGENT_2_OUTPUT = "queue:agent2:output"

QUEUE_AGENT_3_INPUT = "queue:agent3:input"
QUEUE_AGENT_3_OUTPUT = "queue:agent3:output"

QUEUE_AGENT_4_INPUT = "queue:agent4:input"
QUEUE_AGENT_4_OUTPUT = "queue:agent4:output"

QUEUE_AGENT_5_INPUT = "queue:agent5:input"
QUEUE_AGENT_5_OUTPUT = "queue:agent5:output"

QUEUE_AGENT_6_INPUT = "queue:agent6:input"
QUEUE_AGENT_6_OUTPUT = "queue:agent6:output"

# ============================================================================
# MISTRAL AI
# ============================================================================

MISTRAL_API_KEY = os.getenv("MISTRAL_API_KEY", "your_mistral_key_here")
MISTRAL_MODEL = "mistral-large-latest"

MISTRAL_GENERATION_PARAMS = {
    "temperature": 0.1,
    "max_tokens": 300,
    "top_p": 0.9
}

# ============================================================================
# –ú–û–î–ï–†–ê–¢–û–†–´
# ============================================================================

# üë• TELEGRAM ID'—ã –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö
MODERATOR_IDS = [
    1621052774,  # –¢–≤–æ–π ID (–∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π)
    # –î–æ–±–∞–≤—å –µ—â–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
    # 2345678901,
    # 3456789012,
]

# ============================================================================
# –ü–†–ê–í–ò–õ–ê –ß–ê–¢–ê (–ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ)
# ============================================================================

DEFAULT_RULES = [
    "1. –ó–∞–ø—Ä–µ—â–µ–Ω –º–∞—Ç –∏ –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –ª–µ–∫—Å–∏–∫–∞",
    "2. –ó–∞–ø—Ä–µ—â–µ–Ω—ã –ª–∏—á–Ω—ã–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –∏ —É–≥—Ä–æ–∑—ã",
    "3. –ó–∞–ø—Ä–µ—â–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–∞ –∏ —Å–ø–∞–º",
    "4. –ó–∞–ø—Ä–µ—â–µ–Ω–∞ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ü–∏—è –ø–æ —Ä–∞—Å–æ–≤–æ–º—É, —Ä–µ–ª–∏–≥–∏–æ–∑–Ω–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É",
    "5. –ó–∞–ø—Ä–µ—â–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã",
    "6. –ó–∞–ø—Ä–µ—â–µ–Ω—ã —Å–µ–∫—Å—É–∞–ª—å–Ω—ã–µ/–ø–æ—Ä–Ω–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
    "7. –°–æ–±–ª—é–¥–∞–π—Ç–µ –≤–µ–∂–ª–∏–≤–æ—Å—Ç—å –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º"
]

# ============================================================================
# –ü–û–†–¢–´ –ê–ì–ï–ù–¢–û–í
# ============================================================================

AGENT_PORTS = {
    1: 8001,  # –ê–≥–µ–Ω—Ç 1 - –ü—Ä–µ–æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    2: 8002,  # –ê–≥–µ–Ω—Ç 2 - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
    3: 8003,  # –ê–≥–µ–Ω—Ç 3 - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (Mistral AI)
    4: 8004,  # –ê–≥–µ–Ω—Ç 4 - –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (–≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π + Mistral)
    5: 8005,  # –ê–≥–µ–Ω—Ç 5 - –ê—Ä–±–∏—Ç—Ä (Mistral AI)
    6: 8006,  # –ê–≥–µ–Ω—Ç 6 - –ê–Ω–∞–ª–∏–∑ –º–µ–¥–∏–∞ (Mistral Vision)
}

# ============================================================================
# –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
# ============================================================================

LOG_LEVEL = "INFO"
LOG_FORMAT = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

def setup_logging(name):
    """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–¥—É–ª—è"""
    logger = logging.getLogger(name)
    logger.setLevel(LOG_LEVEL)
    
    # –ö–æ–Ω—Å–æ–ª—å
    handler = logging.StreamHandler()
    handler.setLevel(LOG_LEVEL)
    formatter = logging.Formatter(LOG_FORMAT)
    handler.setFormatter(formatter)
    
    if not logger.handlers:
        logger.addHandler(handler)
    
    return logger

# ============================================================================
# –ü–£–¢–ò
# ============================================================================

BASE_DIR = Path(__file__).resolve().parent
LOGS_DIR = BASE_DIR / "logs"
DATA_DIR = BASE_DIR / "data"

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
LOGS_DIR.mkdir(exist_ok=True)
DATA_DIR.mkdir(exist_ok=True)

# ============================================================================
# –î–†–£–ì–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ============================================================================

# –¢–∞–π–º–∞—É—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
REQUEST_TIMEOUT = 30

# –ú–∞–∫—Å–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞ —Ä–∞–∑
MAX_MESSAGES_BATCH = 100

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ
RETRY_ATTEMPTS = 3
RETRY_DELAY = 2  # –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

# ============================================================================
# –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# ============================================================================

if __name__ == "__main__":
    print("=" * 70)
    print("‚öôÔ∏è  –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø TELEGUARD BOT")
    print("=" * 70)
    print(f"‚úÖ Telegram Token: {'***' + TELEGRAM_BOT_TOKEN[-10:]}")
    print(f"‚úÖ PostgreSQL: {DB_HOST}:{DB_PORT}/{DB_NAME}")
    print(f"‚úÖ Redis: {REDIS_HOST}:{REDIS_PORT}")
    print(f"‚úÖ Mistral API: {'–ù–∞—Å—Ç—Ä–æ–µ–Ω' if MISTRAL_API_KEY != 'your_mistral_key_here' else '–ù–ï –ù–ê–°–¢–†–û–ï–ù'}")
    print(f"‚úÖ –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã: {len(MODERATOR_IDS)} —á–µ–ª–æ–≤–µ–∫")
    print(f"‚úÖ –ü—Ä–∞–≤–∏–ª–∞: {len(DEFAULT_RULES)} –ø—Ä–∞–≤–∏–ª")
    print(f"‚úÖ –ê–≥–µ–Ω—Ç—ã: {len(AGENT_PORTS)} –∞–≥–µ–Ω—Ç–æ–≤")
    print("=" * 70)